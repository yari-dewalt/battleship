(()=>{"use strict";class e{constructor(){this.board=Array.from({length:10},(()=>Array(10).fill(""))),this.ships=[],this.missedAttacks=[]}placeShip(e,t,a,s){if(this.isValidPlacement(e,t,a,s)){for(let r=0;r<e.length;r++)"horizontal"===s?this.board[t][a+r]=e:this.board[t+r][a]=e;return this.ships.push({ship:e,row:t,col:a,orientation:s}),!0}return!1}isValidPlacement(e,t,a,s){if("horizontal"===s&&a+e.length>10||"vertical"===s&&t+e.length>10)return!1;for(let r=0;r<e.length;r++){if("horizontal"===s&&""!=this.board[t][a+r])return!1;if("vertical"===s&&""!=this.board[t+r][a])return!1}return!0}receiveAttack(e,t){for(const a of this.ships){const{ship:s,row:r,col:i,orientation:n}=a;if("horizontal"===n&&e===r&&t>=i&&t<i+s.length||"vertical"===n&&t===i&&e>=r&&e<r+s.length)return s.hit(),this.board[e][t]="hit",!0}return this.missedAttacks.push({row:e,col:t}),this.board[e][t]="miss",!1}allShipsSunk(){return this.ships.every((e=>e.ship.isSunk()))}}class t{constructor(e){this.length=e,this.num_hits=0,this.is_sunk=!1}hit(){return this.num_hits++,this.num_hits}isSunk(){return this.num_hits===this.length&&(this.is_sunk=!0),this.is_sunk}}const a=document.getElementsByClassName("gameboard"),s=a[0],r=a[1],i=document.getElementById("start-button");i.style.display="none";const n=document.getElementById("your-turn");n.style.display="none";const o=document.getElementById("enemy-turn");o.style.display="none";const l=document.getElementsByClassName("player-ship-info");let h,d,c="horizontal";const m=document.getElementById("orientation"),u=new class{constructor(){this.gameboard=new e,this.isTurn=!0}createShip(e){let a=new t(e);return this.gameboard.ships.push(a),a}makeMove(e,t,a){e.receiveAttack(t,a),this.isTurn=!1}},p=new class{constructor(){this.gameboard=new e,this.previousAttacks=[],this.isTurn=!1}createShips(){let e=[],a=new t(5),s=new t(4),r=new t(3),i=new t(3),n=new t(2);e.push(a),e.push(s),e.push(r),e.push(i),e.push(n);for(let t of Object.values(e)){let e=!1;for(;!e;){let a=Math.floor(10*Math.random()),s=Math.floor(10*Math.random()),r=Math.floor(10*Math.random())%2;if(r=0===r?"horizontal":"vertical",e=this.gameboard.placeShip(t,a,s,r),e)break}}}makeMove(e){let t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());for(;this.hasAttackedBefore(t,a);)t=Math.floor(10*Math.random()),a=Math.floor(10*Math.random());e.receiveAttack(t,a),this.previousAttacks.push({randomRow:t,randomCol:a}),this.isTurn=!1}hasAttackedBefore(e,t){return this.previousAttacks.some((a=>a.row===e&&a.col===t))}};p.createShips();let f=!1;function y(e,t){for(function(){let e=document.getElementById("player-ships").children,t=!0;for(let a=1;a<e.length;a++)if("player-ship-info placed"!=e[a].className){t=!1;break}return t}()&&(i.style.display="block");s.lastChild;)s.removeChild(s.lastChild);for(;r.lastChild;)r.removeChild(r.lastChild);for(let t=0;t<e.board.length;t++){let a=document.createElement("div");a.className="grid-row";for(let s=0;s<e.board[t].length;s++){let r=document.createElement("div");r.className="grid-square";let i=document.createElement("div");""==e.board[t][s]?i.className="square-identity water":"miss"===e.board[t][s]?i.className="square-identity miss":"hit"===e.board[t][s]?i.className="square-identity hit":i.className="square-identity ship",r.appendChild(i),f||r.addEventListener("click",(()=>{u.gameboard.placeShip(h,t,s,c)&&(d.className="player-ship-info placed",h=null),y(u.gameboard,p.gameboard)})),a.appendChild(r)}s.appendChild(a)}for(let e=0;e<t.board.length;e++){let a=document.createElement("div");a.className="grid-row";for(let s=0;s<t.board[e].length;s++){let r=document.createElement("div");r.className="grid-square";let i=document.createElement("div");""==t.board[e][s]?i.className="square-identity water":"miss"===t.board[e][s]?i.className="square-identity miss":"hit"===t.board[e][s]?i.className="square-identity hit":i.className="square-identity water",r.appendChild(i),f&&u.isTurn&&r.addEventListener("click",(()=>{u.makeMove(p.gameboard,e,s),y(u.gameboard,p.gameboard),p.isTurn=!0,u.isTurn=!1})),a.appendChild(r)}r.appendChild(a)}}y(u.gameboard,p.gameboard),i.addEventListener("click",(()=>{f=!0,y(u.gameboard,p.gameboard),function e(){p.isTurn?(n.style.display="none",o.style.display="block",p.makeMove(u.gameboard),u.isTurn=!0,y(u.gameboard,p.gameboard)):u.isTurn&&(o.style.display="none",n.style.display="block"),(u.gameboard.allShipsSunk()?(console.log("the computer wins!"),f=!1,1):p.gameboard.allShipsSunk()&&(console.log("the player wins!"),f=!1,1))||setTimeout(e,1e3)}()})),f||Array.from(l).forEach(((e,a)=>{e.addEventListener("click",(()=>{"player-ship-info placed"!==e.className&&(Array.from(l).forEach((e=>{"player-ship-info placed"!==e.className&&(e.className="player-ship-info")})),e.className="player-ship-info selected",h=new t(l[a].lastElementChild.childElementCount),d=e)}))})),document.addEventListener("keydown",(e=>{if("f"===e.key||"F"===e.key){if("horizontal"===c)return c="vertical",void(m.textContent="Orientation (F): Vertical");if("vertical"===c)return c="horizontal",void(m.textContent="Orientation (F): Horizontal")}}))})();